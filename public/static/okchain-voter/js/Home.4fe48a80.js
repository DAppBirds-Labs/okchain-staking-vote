(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["Home"],{"1f59":function(t,e,s){},"3d5e":function(t,e,s){"use strict";var i=s("1f59"),a=s.n(i);a.a},"7f43":function(t,e,s){},"853e":function(t,e,s){"use strict";var i=s("7f43"),a=s.n(i);a.a},b611:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home-page"},[s("div",{staticClass:"pc-inner-widget"},[s("div",{staticClass:"banner"},[s("h1",{staticClass:"slogon"},[t._v(t._s(t.$t("OKT 抵押投票")))]),s("div",{staticClass:"brief"},[t._v(t._s(t.$t("参与 OKChain 生态治理，共享区块链价值未来")))])]),s("div",{staticClass:"dashboard"},[s("div",{staticClass:"dash-item"},[s("div",{staticClass:"item-left"},[s("div",{staticClass:"title"},[t._v(t._s(t.$t("我的OKT")))]),t.$root.isLogin?s("div",{staticClass:"value"},[t._v(t._s(t.$root.accountInfo.fmtAssetBalance))]):s("a",{staticClass:"common-button button-small",attrs:{href:"javascript:;"},on:{click:t.onLogin}},[t._v("登录")])]),s("div",{staticClass:"item-icon"})]),s("div",{staticClass:"dash-item"},[s("div",{staticClass:"item-left"},[s("div",{staticClass:"title"},[t._v(t._s(t.$t("抵押中的OKT")))]),s("div",{staticClass:"value"},[t._v("\n            "+t._s(t.$root.accountInfo.fmtTokens)+"\n            "),t.$root.isLogin?s("a",{staticClass:"common-button button-small",attrs:{href:"javascript:;"},on:{click:t.onDelegate}},[t._v(t._s(t.$t("抵押")))]):t._e()])]),s("div",{staticClass:"item-icon"})]),s("div",{staticClass:"dash-item"},[s("div",{staticClass:"item-left"},[s("div",{staticClass:"title"},[t._v(t._s(t.$t("平台用户已抵押（OKT）")))]),s("div",{staticClass:"value"},[t._v(t._s(t.fmtTotalDelegateTokens))])]),s("div",{staticClass:"item-icon"})])]),s("div",{staticClass:"container"},[s("div",{staticClass:"top-view"},[s("div",{staticClass:"guide-text"},[s("div",{staticClass:"guide-item"},[t._v(t._s(t.$t("用户参与节点投票方式：采用一票多投的方式进行投票；")))]),s("div",{staticClass:"guide-item"},[t._v(t._s(t.$t("投票节点按用户投票数量选出出块节点和备选节点，节点获得收益后自主分配节点与用户之间收益份额；")))]),s("div",{staticClass:"guide-item"},[t._v(t._s(t.$t("用户选择撤票后，需要14天的锁定期，锁定期后，抵押的OKT将被释放。")))])]),s("div",{staticClass:"search-view"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.keyword,expression:"keyword"}],attrs:{placeholder:t.$t("搜索节点名称"),type:"text"},domProps:{value:t.keyword},on:{input:function(e){e.target.composing||(t.keyword=e.target.value)}}}),s("a",{staticClass:"search-icon",attrs:{href:"javascript:;"}})])]),s("div",{class:"node-list clearfix"+(t.currentCheckedList.length>0?" check-list-mode":"")},t._l(t.currentDataList,(function(e,i){return s("div",{key:i,class:"node-item validator-item"+(e.is_checked?" item-selected":""),attrs:{href:"javascript:;"}},[s("div",{staticClass:"node-info"},[s("a",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:e.description.logo,expression:"item.description.logo",arg:"background-image"}],staticClass:"item-icon",attrs:{href:"/node/"+e.operator_address,target:"_blank"}}),s("a",{staticClass:"item-title",attrs:{href:"/node/"+e.operator_address,target:"_blank"}},[t._v(t._s(e.description.moniker))]),s("a",{staticClass:"item-checkbox",attrs:{href:"javascript:;"},on:{click:function(s){return t.changeSelected(e)}}},[s("div",{class:"global-icon-checkbox"+(e.is_checked?" selected":"")})]),s("div",{staticClass:"halfline"})]),s("div",{staticClass:"node-data"},[s("div",{staticClass:"data-item"},[t._v(t._s(e.vote_num)),s("span",{staticClass:"sub"},[t._v(t._s(t.$t("人参与")))])]),s("div",{staticClass:"data-item"},[t._v(t._s(e.fmt_vote_token)),s("span",{staticClass:"sub"},[t._v("OKT")])])])])})),0)])]),t.currentCheckedList.length>0?s("div",{staticClass:"footer-checked-view"},[s("div",{staticClass:"checked-inner"},[s("div",{staticClass:"pc-inner-widget"},[s("div",{ref:"votedList",staticClass:"voted-list"},t._l(t.currentCheckedList,(function(e,i){return s("a",{key:i,staticClass:"voted-item",attrs:{href:"javascript:;"},on:{click:function(s){return t.changeSelected(e)}}},[s("span",{directives:[{name:"lazy",rawName:"v-lazy:background-image",value:e.logo,expression:"item.logo",arg:"background-image"}],staticClass:"icon"}),s("div",{staticClass:"ellipsis title"},[t._v(t._s(e.name))]),s("div",{staticClass:"title-cancel"},[t._v(t._s(t.$t("取消")))])])})),0),s("div",{staticClass:"voted-operate"},[s("div",{staticClass:"operate-buttons"},[s("a",{staticClass:"common-button",attrs:{href:"javascript:;"},on:{click:t.confirmVote}},[t._v("确认投票 "),s("span",[t._v(t._s(t.currentCheckedList.length))]),t._v("/"+t._s(t.maxVoteCount))]),s("br"),s("a",{staticClass:"button-cancel",attrs:{href:"javascript:;"},on:{click:t.cancelVote}},[t._v(t._s(t.$t("取消")))])])])])])]):t._e(),t.flagShowDelegateDialog?s("staking-delegate-dialog",{on:{onClose:function(e){t.flagShowDelegateDialog=!1}}}):t._e(),t.flagShowVoteDialog?s("vote-dialog",{attrs:{nodeList:t.checkedList},on:{onClose:function(e){t.flagShowVoteDialog=!1},onSuccess:t.onVoteSuccess}}):t._e()],1)},a=[],n=(s("96cf"),s("3b8d")),o=(s("ac6a"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("common-dialog-view",{attrs:{onTapClose:!1,buttonLeft:t.$t("取消"),buttonRightDisabled:t.loading,buttonRight:t.loading?t.$t("操作中..."):t.$t("确认"),title:t.$t("抵押")},on:{onButtonLeftTap:t.onClose,onButtonRightTap:t.onButtonRightTap,onClose:t.onClose}},[s("div",{staticClass:"common-form-item"},[s("div",{staticClass:"form-icon",style:"background-image:url(//image.cd.mmzhuli.com/09154341cb30ff563f9879d1a1e7ed29?hjw=80&hjh=80)"}),s("input",{directives:[{name:"model",rawName:"v-model",value:t.num,expression:"num"}],attrs:{min:"0",placeholder:t.$t("请输入OKT数量"),type:"number"},domProps:{value:t.num},on:{input:function(e){e.target.composing||(t.num=e.target.value)}}}),s("a",{staticClass:"form-suffix",attrs:{href:"javascript:;"},on:{click:t.setAllNum}},[t._v(t._s(t.$t("全部")))]),s("div",{staticClass:"form-tips"},[t._v(t._s(t.$t("可用"))+"："),s("span",[t._v(t._s(t.$root.accountInfo.fmtAssetBalance)+" OKT")])])])])}),c=[],r=s("70f3"),l=s("bf60"),u={data:function(){return{num:"",loading:!1}},components:{CommonDialogView:r["a"]},methods:{setAllNum:function(){this.num=parseFloat(this.$root.accountInfo.asset_balance,10)||0},onButtonRightTap:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s,i,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=parseFloat(this.num,10)||0,!(e<=0)){t.next=4;break}return this.toast(this.$t("请输入投票数量")),t.abrupt("return");case 4:if(!(e>this.$root.accountInfo.asset_balance)){t.next=7;break}return this.toast(this.$t("可用余额不足")),t.abrupt("return");case 7:return this.loading=!0,t.next=10,Object(l["f"])(e);case 10:if(s=t.sent,i=s.code,a=s.message,this.loading=!1,0===i){t.next=18;break}return 2e4===i&&(this.onClose(),this.eventBus.$emit("showLoginDialog")),this.toast(a),t.abrupt("return");case 18:this.$emit("onSuccess"),this.toast(this.$t("投票成功"),"success"),this.eventBus.$emit("refreshUserInfo"),this.onClose();case 22:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onClose:function(){this.$emit("onClose")}}},d=u,h=s("2877"),f=Object(h["a"])(d,o,c,!1,null,"670f01c2",null),v=f.exports,m=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("common-dialog-view",{attrs:{onTapClose:!1,buttonLeft:t.$t("取消"),buttonRightDisabled:t.loading,buttonRight:t.loading?t.$t("操作中..."):t.$t("确认"),title:t.$t("确认投票")},on:{onButtonLeftTap:t.onClose,onButtonRightTap:t.onButtonRightTap,onClose:t.onClose}},[s("div",{staticClass:"dialog-tips"},[t._v("\n    确认要将抵押的 "),s("span",[t._v(t._s(t.$root.accountInfo.fmtTokens)+" OKT")]),t._v("，投给"),s("br"),t._v("所选的"+t._s(t.nodeList.length)+"个节点吗？\n  ")])])},g=[],p={data:function(){return{loading:!1}},props:{nodeList:{type:Array,default:[]}},components:{CommonDialogView:r["a"]},methods:{onButtonRightTap:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loading=!0,t.next=3,Object(l["h"])(this.nodeList);case 3:if(e=t.sent,s=e.code,i=e.message,this.loading=!1,0===s){t.next=10;break}return this.toast(i),t.abrupt("return");case 10:this.$emit("onSuccess"),this.onClose(),this.toast(this.$t("投票成功"),"success");case 13:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),onClose:function(){this.$emit("onClose")}}},_=p,C=(s("853e"),Object(h["a"])(_,m,g,!1,null,"acce910a",null)),k=C.exports,b=s("408b"),$=s("b689"),w={data:function(){return{page_code:"home-page-1",log_type:"home-pv",nodeList:[],nodeListCache:{},keyword:"",checkedList:[],maxVoteCount:30,flagShowDelegateDialog:!1,flagShowVoteDialog:!1,fmtTotalDelegateTokens:"0.0000"}},created:function(){this.startLoading(),this.initData()},computed:{currentDataList:function(){var t=this,e=null;return e=this.keyword?this.nodeList.filter((function(e){return e.description.moniker.toLowerCase().indexOf(t.keyword.toLowerCase())>=0})):this.nodeList,e},currentCheckedList:function(){var t=this,e=[];return this.checkedList.forEach((function(s){e.push(t.nodeListCache[s])})),e},totalVoteCount:function(){if(this.nodeList.length<=0)return"0.0000";var t=0;return this.nodeList.forEach((function(e){t+=parseFloat(e.vote_token,10)||0})),this.formatCoinNumber(t||0)}},components:{StakingDelegateDialog:v,VoteDialog:k},methods:{onDelegate:function(){this.$root.isWalletLocked?this.onLogin():this.flagShowDelegateDialog=!0},onLogin:function(){this.eventBus.$emit("showLoginDialog")},confirmVote:function(){if(this.$root.isWalletLocked)this.onLogin();else{if(!(this.checkedList.length<2))return this.$root.accountInfo.tokens<=0?(this.toast(this.$t("抵押的OKT余额不足，请先抵押~")),void this.onDelegate()):void(this.flagShowVoteDialog=!0);this.toast(this.$t("最少选择两个节点哦~"))}},onVoteSuccess:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["f"])({user_address:this.$root.walletAddress});case 2:this.cancelVote(),this.initData();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),cancelVote:function(){this.checkedList=[],this.nodeList.filter((function(t){return 1===t.is_checked})).forEach((function(t){t.is_checked=0}))},changeSelected:function(t){var e=this,s=t.operator_address,i=this.checkedList.indexOf(s);if(i>=0)if(this.checkedList.splice(i,1),"number"===typeof t.is_checked)t.is_checked=0;else{var a=this.nodeList.filter((function(t){return t.operator_address===s}));a.length>0&&(a[0].is_checked=0)}else{if(this.checkedList.length>=this.maxVoteCount)return void this.toast(this.$t("每个账户最多可投".concat(this.maxVoteCount,"个节点")));this.checkedList.push(s),t.is_checked=1,this.$nextTick((function(){e.$refs.votedList.scrollLeft=1e6}))}},initData:function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(){var e,s,i,a,n,o=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(b["c"])().then(this.pluginFilterResponse).catch(this.pluginFilterResponse);case 2:if(e=t.sent,s=e.success,i=e.data,a=e.extra,this.stopLoading(),s){t.next=9;break}return t.abrupt("return");case 9:this.nodeListCache={},i.forEach((function(t){t.vote_num=o.formatNumber(t.vote_num),t.fmt_vote_token=o.formatCoinNumber(t.vote_token),t.description.logo=$["a"].compressImage(t.description.logo,{w:80}),t.is_checked=0,o.nodeListCache[t.operator_address]={consensus_pubkey:t.consensus_pubkey,operator_address:t.operator_address,name:t.description.moniker,logo:t.description.logo}})),this.nodeList=i,n=a.pool_bonded_tokens,this.fmtTotalDelegateTokens=this.formatCoinNumber(n);case 14:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}},L=w,x=(s("3d5e"),Object(h["a"])(L,i,a,!1,null,"2c869cb4",null));e["default"]=x.exports}}]);